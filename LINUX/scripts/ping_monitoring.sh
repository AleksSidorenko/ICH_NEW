#!/bin/bash

# –ó–∞–ø—Ä–æ—Å –∞–¥—Ä–µ—Å–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
TARGET=${1:-$(read -p "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–ª—è –ø–∏–Ω–≥–∞: " addr && echo "$addr")}

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∞–¥—Ä–µ—Å –≤–≤–µ–¥–µ–Ω
if [ -z "$TARGET" ]; then
    echo "–ù–µ —É–∫–∞–∑–∞–Ω –∞–¥—Ä–µ—Å –¥–ª—è –ø–∏–Ω–≥–∞. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã."
    exit 1
fi

# –°—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
fail_count=0

echo "–ù–∞—á–∏–Ω–∞–µ–º –ø–∏–Ω–≥–æ–≤–∞—Ç—å $TARGET..."

while true; do
    # –ó–∞–ø—É—Å–∫ –ø–∏–Ω–≥–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
    ping_output=$(ping -c 1 "$TARGET" 2>/dev/null)
    
    if echo "$ping_output" | grep "time="; then
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–∏–Ω–≥–∞
        ping_time=$(echo "$ping_output" | grep -oP 'time=\K[0-9.]+')

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
        if (( $(echo "$ping_time > 10" | bc -l) )); then
            echo "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ ($ping_time –º—Å) –ø—Ä–µ–≤—ã—à–∞–µ—Ç 100 –º—Å."
        else
            echo "‚úÖ –ü–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω: $ping_time –º—Å"
        fi
        
        # –û–±–Ω—É–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á
        fail_count=0
    else
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        ((fail_count++))
        echo "‚ùå –û—à–∏–±–∫–∞! –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–∏–Ω–≥ ($fail_count/3)."
    fi

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —Ç—Ä–∏ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥—Ä—è–¥ –Ω–µ—É–¥–∞—á–Ω—ã
    if [ "$fail_count" -ge 3 ]; then
        echo "üö® –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ! –¢—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥—Ä—è–¥."
        exit 1
    fi

    # –û–∂–∏–¥–∞–Ω–∏–µ 1 —Å–µ–∫—É–Ω–¥—É –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –ø–∏–Ω–≥–æ–º
    sleep 1
done

