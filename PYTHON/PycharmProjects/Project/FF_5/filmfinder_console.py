# filmfinder_console.py
# –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FilmFinder
# –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ CLI —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ questionary

import questionary  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
from search_engine import search_by_keyword, search_by_genre_and_year, get_all_genres  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –º–æ–¥—É–ª—è
from logger import log_query, get_top_queries  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

# –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∂–∞–Ω—Ä–æ–≤ –∏ —ç–º–æ–¥–∑–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
GENRE_EMOJIS = {
    "Action": "üí•",         # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Action
    "Animation": "üé®",      # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Animation
    "Comedy": "üòÇ",         # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Comedy
    "Drama": "üé≠",          # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Drama
    "Horror": "üëª",         # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Horror
    "Music": "üéµ",          # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Music
    "Sci-Fi": "üöÄ",         # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Sci-Fi
    "Fantasy": "üßô",        # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Fantasy
    "Romance": "‚ù§Ô∏è",        # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Romance
    "Thriller": "üî™",       # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Thriller
    "Adventure": "üó∫Ô∏è",      # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Adventure
    "Crime": "üïµÔ∏è",          # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Crime
    "Documentary": "üé¨"     # –≠–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞ Documentary

# üéûÔ∏è Children
# üéûÔ∏è Classics
# üéûÔ∏è Family
# üéûÔ∏è Foreign
# üéûÔ∏è Games
}

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –º–µ–Ω—é
def print_menu():
    print("\nüé¨ === FilmFinder (–ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) ===")  # –í—ã–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    print("1. üîç –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É")       # –ü—É–Ω–∫—Ç 1 ‚Äî –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á—É
    print("2. üé≠ –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É")          # –ü—É–Ω–∫—Ç 2 ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
    print("3. üìà –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã")            # –ü—É–Ω–∫—Ç 3 ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print("4. ‚ùå –í—ã–π—Ç–∏")                                  # –ü—É–Ω–∫—Ç 4 ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

# –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
def handle_keyword_search():
    keyword = input("–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: ").strip()  # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ª–æ–≤–æ
    if not keyword:                                      # –ï—Å–ª–∏ –ø—É—Å—Ç–æ–π –≤–≤–æ–¥ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
        print("‚ö†Ô∏è –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        return                                           # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    log_query(keyword)                                  # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –≤ –ø–∞–º—è—Ç—å (–≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É)
    results = search_by_keyword(keyword)                # –í—ã–ø–æ–ª–Ω—è–µ–º SQL-–∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º (SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞)
    print("\nüéûÔ∏è –ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤:")                       # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    if results:                                          # –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–π–¥–µ–Ω—ã
        for title, description in results:              # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –∏ –≤—ã–≤–æ–¥–∏–º —Ñ–∏–ª—å–º—ã
            print(f"- {title}: {description}")
    else:
        print("‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.")                     # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

# –§—É–Ω–∫—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∂–∞–Ω—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
def select_genre(genres):
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ —Å —ç–º–æ–¥–∑–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–µ–Ω—é
    choices = [f"{GENRE_EMOJIS.get(g, 'üéûÔ∏è')} {g}" for g in genres]
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–±–æ—Ä
    genre = questionary.select("üé≠ –í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä:", choices=choices).ask()
    # –£–¥–∞–ª—è–µ–º —ç–º–æ–¥–∑–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å—Ç–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞
    return genre.split(' ', 1)[1] if genre else None

# –§—É–Ω–∫—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≥–æ–¥–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
def select_year():
    years = [str(y) for y in range(2023, 1999, -1)]       # –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –≥–æ–¥–æ–≤ –æ—Ç 2023 –¥–æ 2000
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ª–µ—Ç —Å —ç–º–æ–¥–∑–∏
    year = questionary.select("üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞:",
                              choices=[f"üìΩÔ∏è {y}" for y in years]).ask()
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ–¥ –±–µ–∑ —ç–º–æ–¥–∑–∏
    return year.replace("üìΩÔ∏è ", "") if year else None

# –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É
def handle_genre_year_search():
    genres = get_all_genres()                             # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –∏–∑ –±–∞–∑—ã (–≤–Ω—É—Ç—Ä–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å)
    if not genres:                                        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∂–∞–Ω—Ä–æ–≤
        print("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤.")
        return

    genre = select_genre(genres)                          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∂–∞–Ω—Ä
    if not genre:                                         # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–∞–∑–∞ –æ—Ç –≤—ã–±–æ—Ä–∞
        print("‚ö†Ô∏è –ñ–∞–Ω—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω.")
        return

    year = select_year()                                  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≥–æ–¥
    if not year:
        print("‚ö†Ô∏è –ì–æ–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω.")                        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–∞–∑–∞ –æ—Ç –≤—ã–±–æ—Ä–∞
        return

    log_query(f"{genre} {year}")                          # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    results = search_by_genre_and_year(genre, year)       # –í—ã–ø–æ–ª–Ω—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å
    print("\nüéûÔ∏è –ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤:")
    if results:                                           # –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å–º—ã ‚Äî –≤—ã–≤–æ–¥–∏–º –∏—Ö
        for title, description in results:
            print(f"- {title}: {description}")
    else:
        print("‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.")                     # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
def handle_show_popular_queries():
    print("\nüìä –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:")                # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
    top_queries = get_top_queries()                       # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ª–æ–≥–æ–≤ (–∏–∑ –ø–∞–º—è—Ç–∏)
    if top_queries:                                       # –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Äî –≤—ã–≤–æ–¥–∏–º
        for query, count in top_queries:
            print(f"{query} ‚Äî {count} —Ä–∞–∑(–∞)")
    else:
        print("‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.")                          # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –±—ã–ª–æ

# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —É–ø—Ä–∞–≤–ª—è—é—â–∞—è —Ü–∏–∫–ª–æ–º —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
def main():
    while True:                                           # –ó–∞–ø—É—Å–∫–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
        print_menu()                                      # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        choice = input("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1‚Äì4): ").strip()  # –ü–æ–ª—É—á–∞–µ–º –≤—ã–±–æ—Ä –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if choice == "1":
            handle_keyword_search()                       # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–∏ 1
        elif choice == "2":
            handle_genre_year_search()                    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–∏ 2
        elif choice == "3":
            handle_show_popular_queries()                 # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–∏ 3
        elif choice == "4":
            print("üëã –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.")              # –ü—Ä–æ—â–∞–µ–º—Å—è
            break                                         # –ó–∞–≤–µ—Ä—à–∞–µ–º —Ü–∏–∫–ª
        else:
            print("‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")  # –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if __name__ == "__main__":
    main()


# üí° –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
# –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ search_engine, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.
# –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª—é–±—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç SQL-–∫–æ–¥–∞:
# cursor.execute("SELECT * FROM films WHERE title LIKE %s", (f"%{keyword}%",))
# –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ ' OR 1=1 --)